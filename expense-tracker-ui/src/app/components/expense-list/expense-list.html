<div class="expense-list">
    <div class="page-header">
        <h1>Expense Management</h1>
        <p>Add, view, and manage your expenses</p>
    </div>

    <!-- Add Expense Form -->
    <div class="add-expense-card">
        <h2>Add New Expense</h2>
        <form (ngSubmit)="onSubmit()" #expenseForm="ngForm" class="expense-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="description">Description</label>
                    <input type="text" id="description" name="description" [(ngModel)]="newExpense.description" required
                        placeholder="What did you spend on?" class="form-control">
                </div>

                <div class="form-group">
                    <label for="amount">Amount ($)</label>
                    <input type="number" id="amount" name="amount" [(ngModel)]="newExpense.amount" required min="0.01"
                        step="0.01" placeholder="0.00" class="form-control">
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" [disabled]="!expenseForm.form.valid || addingExpense" class="btn btn-primary">
                    <span *ngIf="addingExpense" class="loading"></span>
                    {{ addingExpense ? 'Adding...' : 'Add Expense' }}
                </button>
                <button type="button" (click)="clearForm()" class="btn btn-outline">
                    Clear
                </button>
            </div>
        </form>
    </div>

    <!-- Expenses List -->
    <div class="expenses-section">
        <div class="section-header">
            <h2>All Expenses</h2>
            <div class="total-display">
                Total: <strong>{{ totalAmount | currency:'USD':'symbol':'1.2-2' }}</strong>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters">
            <div class="filter-group">
                <label>Category:</label>
                <select [(ngModel)]="selectedCategory" (change)="applyFilters()">
                    <option value="">All Categories</option>
                    <option *ngFor="let category of categories" [value]="category">
                        {{ category }}
                    </option>
                </select>
            </div>

            <div class="filter-group">
                <label>Sort by:</label>
                <select [(ngModel)]="sortBy" (change)="applyFilters()">
                    <option value="date-desc">Date (Newest First)</option>
                    <option value="date-asc">Date (Oldest First)</option>
                    <option value="amount-desc">Amount (High to Low)</option>
                    <option value="amount-asc">Amount (Low to High)</option>
                </select>
            </div>
        </div>

        <!-- Expenses Table -->
        <div *ngIf="filteredExpenses.length > 0; else noExpenses" class="expenses-table">
            <div class="table-header">
                <div class="col description">Description</div>
                <div class="col amount">Amount</div>
                <div class="col category">Category</div>
                <div class="col date">Date</div>
                <div class="col actions">Actions</div>
            </div>

            <div class="table-body">
                <div *ngFor="let expense of filteredExpenses" class="table-row">
                    <div class="col description">
                        <span class="expense-desc">{{ expense.description }}</span>
                        <div *ngIf="expense.aiInsights" class="ai-badge" title="AI Categorized">
                            ðŸ¤–
                        </div>
                    </div>
                    <div class="col amount">
                        <span class="amount-value">{{ expense.amount | currency:'USD':'symbol':'1.2-2' }}</span>
                    </div>
                    <div class="col category">
                        <span class="category-tag" [class]="'category-' + expense.category.toLowerCase()">
                            {{ expense.category }}
                        </span>
                    </div>
                    <div class="col date">
                        {{ expense.date | date:'MMM dd, yyyy' }}
                    </div>
                    <div class="col actions">
                        <button (click)="deleteExpense(expense.id!)" [disabled]="deletingId === expense.id"
                            class="btn btn-danger btn-sm">
                            <span *ngIf="deletingId === expense.id" class="loading"></span>
                            {{ deletingId === expense.id ? 'Deleting...' : 'Delete' }}
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <ng-template #noExpenses>
            <div class="empty-state">
                <div class="empty-icon">ðŸ’¸</div>
                <h3>No expenses found</h3>
                <p *ngIf="selectedCategory">
                    No expenses match the selected category.
                    <a (click)="clearFilters()" class="link">Clear filters</a> to see all expenses.
                </p>
                <p *ngIf="!selectedCategory">
                    You haven't added any expenses yet. Start by adding your first expense above!
                </p>
            </div>
        </ng-template>
    </div>
</div>